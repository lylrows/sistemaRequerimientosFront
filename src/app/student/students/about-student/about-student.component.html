<section class="content"  >
  <div class="content-block"  >
    <div class="block-header" *ngFor="let breadscrum of breadscrums" >
      <!-- breadcrumb -->
      <app-breadcrumb [title]="breadscrum.title" [items]="breadscrum.items" [active_item]="breadscrum.active" >
      </app-breadcrumb>
    </div>
    <!-- Your content goes here  -->
    <div class="row clearfix"> 
      <div class="col-lg-12 col-md-12">
        <div class="card">
          <mat-tab-group style="overflow-x: hidden;">
            <mat-tab style="overflow-x: hidden;">
              <ng-template mat-tab-label >
                <mat-icon class="example-tab-icon msr-2">developer_board</mat-icon>
                ticket
              </ng-template>
              <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="project_widget">
                  <div class="container2">
                    <div class="header">
                      <h2><strong>Descripción</strong></h2>
                    </div>
                    <div class="column2">
                      <strong>N° Ticket</strong>
                      <strong>: {{incidenciaDetalle.idTicket}}</strong>
                    </div>
                    <div class="column2">
                      <strong>¿Cumplió ANS?:</strong>
                      <strong> {{ansText}} </strong>
                    </div>
                  </div>
                  
                 
                  <div class="body" >
                    <div class="row">
                      <div class="col-md-3 col-6 b-r">
                        <strong>Nombre</strong>
                        <br>
                        <p class="text-muted">{{studentsServ.Incidenciadetalle.incidente}}</p>
                      </div>
                      <div class="col-md-3 col-6 b-r" [hidden]="studentsServ.Incidenciadetalle.tipoIncidencia == null">
                        <strong>Tipo de ticket</strong>
                        <br>
                        <p class="text-muted">{{studentsServ.Incidenciadetalle.tipoIncidencia}}</p>
                      </div>
                      <div class="col-md-3 col-6 b-r">
                        <strong>Prioridad</strong>
                        <br>
                        <p class="text-muted">{{studentsServ.Incidenciadetalle.prioridad}}</p>
                      </div>
                      <div class="col-md-3 col-6">
                        <strong>Estado</strong>
                        <br>
                        <p class="text-muted">{{studentsServ.Incidenciadetalle.estado}}</p>
                      </div> 
                      <!-- <div class="col-md-3 col-6">
                        <strong>N° Ticket</strong>
                        <br>
                        <p class="text-muted">{{incidenciaDetalle.idTicket}}</p>
                      </div> -->
                      
                    </div>                   
                  </div>                

                </div>
              </div>
              <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="project_widget">
                  <div class="header">
                    <h2><strong>Secuencia Comentarios</strong></h2>
                  </div>
                  <div class="body">
                    <div class="container">
                      <div class="row">
                        <div class="col-md-10">
                          <ul class="left-timeline">
                            <li *ngFor="let com of comentariosDTO">
                              <tr>                                                      
                              <time class="left-time" datetime="2017-11-04T18:30"><span class="hidden">{{com.fechaRegistro | date: "dd/MM/yyyy, h:mm a"}}</span>
                              </time>
                              </tr>
                              <br>
                              <tr>
                                <time class="left-time" datetime="2017-11-04T18:30">
                              <span>{{com.usuario}}</span>
                                </time>
                              </tr>
                              <div class="left-icon"><img [src]="com.img" alt="User" style="width: 50px; height: 50px;">
                              </div>
                              <div class="left-label empty"> 
                                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2">
                                  <div class="body">
                                    <ckeditor [editor]="Editor2" [config]="{ toolbar: none, readonly:true}" [data]="com.comentario" disabled="true"></ckeditor>
                                  </div>
                                </div>
                                 </div>  
                            </li>
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 mb-2">
                              <div class="example-button-row" [hidden]="changeButon">
                                <button mat-raised-button color="primary" (click)="addComentario()" tabindex="-1">
                                  <mat-icon>add_comment</mat-icon>
                                  Agregar Respuesta
                                </button>
                              </div>
                              
                          </div>                            
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div> 
                  <div class="header">
                    <!-- <h2><strong>Agregar Comentarios</strong></h2> -->
                  </div>
                  <div class="row">
                    
                </div>                   
             <!-- CKEDITOR, PARA LOS COMENTARIOS -->
             <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2" >
              <div class="row clearfix">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                  <div class="card">                  
                    <div class="body" [hidden]="boolEditor">
                      <form class="register-form m-4" [formGroup]="EditorForm" >
                        <ckeditor [editor]="Editor" data="" formControlName="comentario" required></ckeditor>           
                        <br>                       
                      </form>   
                      <div class="row">
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2">
                          <div class="example-button-row" style="align-items: center; text-align: center">
                            <button mat-raised-button color="primary" [disabled]="!EditorForm.valid" (click)="grabarRespuesta()" style="width: 180px;" matTooltip="Agrega una respuesta">
                              <mat-icon style="color: white;">save</mat-icon>
                              Grabar Respuesta
                            </button>
                            <button mat-raised-button color="accent" [disabled]="!EditorForm.valid" (click)="grabarNotificar()" style="width: 180px;" matTooltip="Notifica al usuario tu respuesta">
                              <mat-icon style="color: white;">email</mat-icon>
                              Grabar y Notificar
                            </button>
                            <button mat-raised-button color="warn" (click)="onNoClick()" tabindex="-1" style="width: 180px;" matTooltip="Cancelar">
                              <mat-icon style="color: white;">cancel</mat-icon>
                              Cancelar
                            </button>
                          </div>
                        </div>
                    </div>  
                    </div>
                  </div>
                </div>              
              </div>              
             </div>
                <div class="col-lg-12 col-md-12 col-sm-12">
                  <div class="">
                    <div class="header">
                      <h2><strong>Actualizar estado del ticket</strong></h2>
                    </div>
                  <div class="body" >
                    <form class="register-form m-4" [formGroup]="Incidencia" >
                    <div class="row">    
                      <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 mb-2">
                        <mat-form-field class="example-full-width mb-3" appearance="outline">
                          <mat-label>Tipo de ticket</mat-label>
                          <mat-select  formControlName="idTipoIncidencia"  >
                            <mat-option [value]="tipo.idTipoIncidencia" *ngFor="let tipo of listTipoTickets">
                              {{tipo.nombre}}
                            </mat-option>                     
                          </mat-select>                 
                        </mat-form-field>
                      </div>
                      <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 mb-2" [hidden]="studentsServ.Incidenciadetalle.estado == 'Conforme'">
                        <mat-form-field class="example-full-width mb-3" appearance="outline">
                          <mat-label>Estado</mat-label>
                          <mat-select formControlName="idEstado" (selectionChange)="onChangeEstado($event.value)" required >
                            <mat-option [value]="est.valorEntero" *ngFor="let est of estados">
                              {{est.nombre}}
                            </mat-option>                      
                          </mat-select>                  
                        </mat-form-field>
                      </div>
                      <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 mb-2" [hidden]="studentsServ.Incidenciadetalle.estado != 'Conforme'">
                        
                          <mat-label>Estado: <a><strong>Conforme</strong></a></mat-label>
                        
                      </div>
                      <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 mb-2" >
                        <mat-form-field class="example-full-width mb-3" appearance="outline">
                            <mat-label>Tipificación</mat-label>
                            <mat-select formControlName="tipificacion" required >
                                <mat-icon matSuffix>notifications_active</mat-icon>                            
                                <mat-option [value]="tip.idTipificacion" *ngFor="let tip of listTipEmpresa">
                                {{ tip.nombre}}
                                </mat-option>                                  
                            </mat-select> 
                        </mat-form-field>
                      </div>
                      <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 mb-2" >
                        <mat-form-field class="example-full-width mb-3" appearance="outline">
                            <mat-label>Prioridad</mat-label>
                            <mat-select formControlName="prioridad" (selectionChange)="onChangePrioridad($event.value)">
                                <mat-icon matSuffix>loyalty</mat-icon>                            
                                <mat-option [value]="pri.valorEntero" *ngFor="let pri of prioridades">
                                {{ pri.nombre}}
                                </mat-option>                                  
                            </mat-select> 
                        </mat-form-field>
                      </div>
                      <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 mb-2">
                        <mat-form-field class="example-full-width mb-3" appearance="outline">
                          <mat-label>Horas estimadas</mat-label>
                          <input type="number" pattern="^\d+(\.\d{1,2})?$" min="0" max="32" step="0.01" matInput formControlName="horasEstimadas" [readonly]="this.incidenciaDetalle.horasEjecutadas != 0">                          
                          <mat-icon matSuffix>hourglass_empty</mat-icon>
                        <mat-error *ngIf="Incidencia.get('horasEstimadas').hasError('required')">
                            Horas estimadas es requerido
                        </mat-error>
                        <mat-error *ngIf="Incidencia.get('horasEstimadas').hasError('min')">
                            El número debe ser mayor a cero.
                        </mat-error>
                        <mat-error *ngIf="Incidencia.get('horasEstimadas').hasError('max')">
                        El número debe ser menor a 32 horas.
                        </mat-error>
                        <mat-error *ngIf="Incidencia.get('horasEstimadas').hasError('pattern')">
                        El número debe tener opcionalmente un punto y dos dígitos decimales.
                        </mat-error>
                      </mat-form-field>
                      </div>
                      <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 mb-2">
                        <mat-form-field class="example-full-width mb-3" appearance="outline">
                          <mat-label>Horas ejecutadas</mat-label>
                          <input type="number" pattern="^\d+(\.\d{1,2})?$" min="0" max="32" step="0.01"  matInput formControlName="horasEjecutadas" required>                          
                          <mat-icon matSuffix>hourglass_full</mat-icon>
                          <mat-error *ngIf="Incidencia.get('horasEjecutadas').hasError('required')">
                              Horas estimadas es requerido
                          </mat-error>
                          <mat-error *ngIf="Incidencia.get('horasEjecutadas').hasError('min')">
                              El número debe ser mayor a cero.
                          </mat-error>
                          <mat-error *ngIf="Incidencia.get('horasEjecutadas').hasError('max')">
                          El número debe ser menor a 32 horas.
                          </mat-error>
                          <mat-error *ngIf="Incidencia.get('horasEjecutadas').hasError('pattern')">
                          El número debe tener opcionalmente un punto y dos dígitos decimales.
                          </mat-error>
                      </mat-form-field>
                      </div>
                      <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 mb-2" [hidden]="boolMotivo">
                        <mat-form-field class="example-full-width mb-3" appearance="outline">
                          <mat-label>Motivo cambio prioridad</mat-label>
                          <input matInput formControlName="motivo">                          
                      </mat-form-field>
                      </div>
                      <mat-label hidden> <strong>Agregar tags al ticket:</strong> </mat-label>
                      <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 mb-2" >
                        <div style="border: 1px solid #ccc; border-radius: 4px; padding: 5px; margin-bottom: 10px; height: 55px;">
                          <mat-chip-list #chipList aria-label="Email selection" >
                            <mat-chip *ngFor="let tag of tagList" [selectable]="selectable" [removable]="removable" (removed)="remove(tag)">
                              {{tag.nombreTag}}
                              <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
                            </mat-chip>
                        
                            <input placeholder="Escribir tag" #emailInput [formControl]="tagCtrl" [matAutocomplete]="auto" [matChipInputFor]="chipList" [matChipInputSeparatorKeyCodes]="separatorKeysCodes" (matChipInputTokenEnd)="add($event)">
                          </mat-chip-list>                    
                          <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event)">
                            <mat-option *ngFor="let tag of filteredTags | async" [value]="tag">
                              {{tag}}
                            </mat-option>
                          </mat-autocomplete>
                        </div>
                      </div>
                    
                    </div>
                    <div class="row" [hidden]="boolCalificacion">
                      <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2">
                        <div class="header">
                          <h2><strong>La Calificación de la atención de su ticket es:</strong></h2>                          
                          <i [class]="classStar1" (click)="changeButon?false:calificacion('star1')"  disabled>{{iconStar1}}</i>
                          <i [class]="classStar2" (click)="changeButon?false:calificacion('star2')"  disabled>{{iconStar2}}</i>
                          <i [class]="classStar3" (click)="changeButon?false:calificacion('star3')"  disabled>{{iconStar3}}</i>
                          <i [class]="classStar4" (click)="changeButon?false:calificacion('star4')"  disabled>{{iconStar4}}</i>
                          <i [class]="classStar5" (click)="changeButon?false:calificacion('star5')"  disabled>{{iconStar5}}</i>
                          
                         
                        </div>
                       
                      </div>
                    </div>
                </form>
              </div>
              <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2">
                  <div class="example-button-row" style="align-items: center; text-align: center" [hidden]="changeButon">
                    <button mat-raised-button color="primary" [disabled]="!Incidencia.valid" (click)="actualizarIncidencia()" style="width: 180px;">
                      <mat-icon style="color: white;">update</mat-icon>
                      Actualizar ticket
                    </button>
                    <button mat-raised-button color="warn" (click)="onNoClick()" tabindex="-1" style="width: 180px;">
                      <mat-icon style="color: white;">cancel</mat-icon>
                      Cancelar
                    </button>
                  </div>                  
                </div>
            </div>
            </div>
              </div>
         
                </div>
              </div>
              <div class="">
                 <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2" [hidden]="boolCalificacion">
                <div class="example-button-row" style="align-items: center; text-align: center">
                  <button mat-raised-button color="primary" 
                                   (click)="volverBandeja()">Volver a la bandeja</button>
                </div>
               </div>
              </div>
             
            </mat-tab>

            <mat-tab>
              <ng-template mat-tab-label>
                <mat-icon class="example-tab-icon msr-2">attach_file</mat-icon>
                Adjuntos
              </ng-template>
              <div class="header">
                <h2>
                   Secuencia de <strong>Evidencias</strong></h2>
              </div>
              <div class="body">
                <section id="cd-timeline" class="cd-container">
                  <div class="cd-timeline-block">
                    <!-- <div class="cd-timeline-img cd-picture">
                      <img [src]="" alt="User">
                    </div>
                
                    <div class="cd-timeline-content">
                      <img [src]="">
                    </div> -->
                    <ul class="left-timeline">
                    <li *ngFor="let com of archivos">
                      <tr>                                                      
                      <time class="left-time" datetime="2017-11-04T18:30"><span class="hidden">{{com.fechaRegistro | date: "dd/MM/yyyy, h:mm a"}}</span>
                      </time>
                      </tr>
                      <br>
                      <tr>
                        <time class="left-time" datetime="2017-11-04T18:30">
                      <span>{{com.usuario}}</span>
                        </time>
                      </tr>
                      <div class="left-icon"><img [src]="com.img" alt="User" style="width: 50px; height: 50px;">
                      </div>

                      <div class="left-label">
                        <div class="row">
                            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2">
                                  <img [src]="com.urlArchivo.includes('.pdf')?'assets/images/logo-pdf.jpg':
                                  com.urlArchivo.includes('.xls')?'assets/images/logo-excel.png':
                                  com.urlArchivo.includes('.doc')?'assets/images/logo-word.jpg':
                                  com.urlArchivo.includes('.rar')?'assets/images/logo-rar.jpg':
                                    com.urlArchivo.includes('.zip')?'assets/images/logo-zip.jpg':
                                    com.urlArchivo.includes('.txt')?'assets/images/logo-txt.png':
                                  com.urlArchivo" style="max-width: 750px; max-height: 450px;" >
                            </div>
                        </div>
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2">
                          <button mat-raised-button color="primary" (click)="descargarArchivo(com.urlArchivo)" 
                    >Descargar</button>
                        </div>
                        </div>

                    </li>
                  </ul>
                  </div>                 
                                 
                </section>
                <!-- cd-timeline -->
                <div class="header" [hidden]="changeButon">
                  <h2>
                     Agregar <strong>Adjuntos</strong></h2>
                </div>
                
                <div class="row">
                  <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 mb-2">
                    <div class="example-button-row" [hidden]="changeButon">
                      <button mat-raised-button color="primary" (click)="addimg()" 
                      tabindex="-1">Agregar archivo</button>
                    </div>
                </div>
              </div> 

              <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2" [hidden]="boolimg">
                <div class="row clearfix">
                  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="">                  
                      <div class="body" >
                        <form class="register-form m-4" [formGroup]="ImgForm" >
                          <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2" > 
                            <app-file-upload *ngIf="!boolimg" formControlName="uploadFile" (change)="capturarFile($event)"></app-file-upload>                    
                          </div>          
                          <br>
                          <div class="row">
                            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2">
                                <div class="example-button-row">
                                    <button mat-raised-button color="primary"  [disabled]="!ImgForm.valid"
                                       (click)="confirmimg()">Guardar</button>
                                    <button mat-raised-button color="warn" (click)="NoClickimg()" tabindex="-1">Cancelar</button>
                                    <button mat-raised-button color="primary" (click)="verfoto()" tabindex="-1">Vista preliminar</button>
                                </div>
                            </div>
                        </div>
                        </form>
                      </div>
                    </div>
                  </div>
  
                  <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2" [hidden]="boolver">
                    <div class="row clearfix">
                      <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3" *ngFor="let img of listpre">
                        <div class="">                  
                          <div class="body">
                            <div >
                              <img width="300px" [src]="img" alt="No Image" (onClick)="clickevento(img)">
                              <button mat-raised-button color="primary" (click)="deleteImg(img)">
                                <mat-icon>restore_from_trash</mat-icon>
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                   </div>
                   
  
                </div>
               </div>


              </div>
              <div class="">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-2">
                <div class="example-button-row" style="align-items: center; text-align: center">
                  <button mat-raised-button color="primary" 
                                   (click)="volverBandeja()">Volver a la bandeja</button>
                </div>
               </div>
              </div>
              
            </mat-tab>
          </mat-tab-group>
        </div>
      </div>
    </div>
  </div>
</section>
